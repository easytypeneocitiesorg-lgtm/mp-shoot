<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Top-Down Shooter</title>
<style>
body { margin:0; background:#111; color:#eee; font-family:sans-serif; text-align:center; }
canvas { background:#0a0a0f; border:1px solid #222; display:block; margin:10px auto; }
</style>
</head>
<body>
<canvas id="game" width="640" height="480"></canvas>
<div id="status">Connecting...</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const statusEl = document.getElementById("status");

let ws = new WebSocket("ws://localhost:8080"); // change to your deployed server
let id = null;
let players = {};
let bullets = [];

let keys = {};
document.addEventListener("keydown", e=>keys[e.key]=true);
document.addEventListener("keyup", e=>keys[e.key]=false);

canvas.addEventListener("click", e=>{
  if(!id) return;
  const p = players[id];
  if(!p || p.dead) return;
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;
  const angle = Math.atan2(my - p.y, mx - p.x);
  const speed = 300;
  ws.send(JSON.stringify({t:'shoot', x:p.x, y:p.y, dx:Math.cos(angle)*speed, dy:Math.sin(angle)*speed}));
});

ws.onmessage = e=>{
  const d = JSON.parse(e.data);
  if(d.t==='init') id = d.id;
  if(d.t==='state'){
    players = d.players;
    bullets = d.bullets;
  }
};

function loop(dt){
  if(id && players[id] && !players[id].dead){
    const p = players[id];
    const speed = 150;
    if(keys["w"]) p.y -= speed*dt;
    if(keys["s"]) p.y += speed*dt;
    if(keys["a"]) p.x -= speed*dt;
    if(keys["d"]) p.x += speed*dt;
    ws.send(JSON.stringify({t:'state', x:p.x, y:p.y}));
  }
  draw();
  requestAnimationFrame(()=>loop(1/60));
}
requestAnimationFrame(()=>loop(1/60));

function draw(){
  ctx.fillStyle="#000"; ctx.fillRect(0,0,canvas.width,canvas.height);

  for(const pid in players){
    const p = players[pid];
    if(p.dead) continue;
    ctx.fillStyle = pid===id?"#0ff":"#f77";
    ctx.fillRect(p.x-10,p.y-10,20,20);
    // health bar
    ctx.fillStyle="#0f0";
    ctx.fillRect(p.x-10,p.y-15,20*(p.hp/100),3);
  }

  ctx.fillStyle="#fff";
  bullets.forEach(b=>ctx.fillRect(b.x-3,b.y-3,6,6));

  statusEl.textContent = `Players: ${Object.keys(players).length} | Your HP: ${players[id]?players[id].hp:'-'}`;
}
</script>
</body>
</html>
